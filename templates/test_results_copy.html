<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_result.css') }}">
    <title>Pie Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="main-div">
        <h2 class="headtext">РЕЗУЛЬТАТИ ОПИТУВАННЯ</h2>
        {% for image, scores in data.items() %}
            <div class="ask-div">
                <img src="{{ urls[loop.index-1] }}" alt="Image">
                <section id="diagram-{{ loop.index }}" class="diagram"></section>
                <button type="button" class='mark-button' disabled="true">{{ avgMark[loop.index] }}</button>
            </div>
    
            <script>
                function drawDiagram(canvasId, data) {
                    const diagram = document.getElementById(canvasId);
                    // const canvasWidth = diagram.width;
                    // const canvasHeight = diagram.height;
                    const canvasWidth = 300;
                    const canvasHeight = 50;
    
                    // Calculate the total sum of values
                    const totalSum = Object.values(data).reduce((a, b) => a + b, 0);
    
                    // Calculate the width of each section based on the values
                    const sectionWidths = {};
                    const sectionLabels = {};
                    for (const key in data) {
                        const value = data[key];
                        const widthPercentage = (value / totalSum) * 100;
                        sectionWidths[key] = (canvasWidth * widthPercentage) / 100;
                        sectionLabels[key] = value + '%';
                    }
    
                    // Set the colors for each section
                    const sectionColors = {
                        1: "#ADB5BD",
                        2: "#6C757D",
                        3: "#495057",
                        4: "#343A40",
                        5: "#212529"
                    };

            
                    // Draw the diagram sections
                    for (const key in sectionWidths) {
                        const sectionWidth = sectionWidths[key];
                        const sectionColor = sectionColors[key];
                        const sectionLabel = sectionLabels[key];

                        const rectangle = document.createElement("div");
                        rectangle.innerHTML = sectionLabel;
                        rectangle.classList.add("rectangle");
                        rectangle.style.width = sectionWidth+"px";
                        rectangle.style.backgroundColor = sectionColor;
                        diagram.appendChild(rectangle);

                    }
                }
    
                document.addEventListener("DOMContentLoaded", function() {
                    const data = {{ scores }};
                    drawDiagram("diagram-{{ loop.index }}", data);
                });
            </script>
        {% endfor %}
    </div>
    
        
</body>
</html>
